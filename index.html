<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ã¡ã‚‰ã®ãŠå®¢æ§˜ã‹ã‚‰ã§ã™ã—ï¼</title>
<style>
  body {
    background: #e0d6c3;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    background: #f4efe6;
    border: 4px solid #3b2a1a;
    margin-top: 10px;
  }
  #bgmBtn {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2 style="color:#3b2a1a">ğŸ£ ã‚ã¡ã‚‰ã®ãŠå®¢æ§˜ã‹ã‚‰ã§ã™ã—ï¼ ğŸ£</h2>
<button id="bgmBtn">BGM OFF</button>

<canvas id="game" width="640" height="220"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const bgmBtn = document.getElementById("bgmBtn");

// =====================
// ğŸ”Š ã‚µã‚¦ãƒ³ãƒ‰
// =====================
const bgm = new Audio("ã‚†ã£ãŸã‚ŠãŠæ•£æ­©.mp3");
bgm.loop = true;
bgm.volume = 0.4;
let bgmOn = true;

const seSlide = new Audio("ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ›ã‚¤ãƒƒã‚¹ãƒ«ä¸‹é™2.mp3");
const seFail  = new Audio("ã‚¬ãƒ¼ãƒ³.mp3");
const seWin   = new Audio("ãƒ‘ãƒ•ãƒ‘ãƒ•ãƒ‘ãƒ•ãƒ‘ãƒ•ãƒ‘ãƒ•1.mp3");

function playSE(audio) {
  const se = audio.cloneNode();
  se.volume = audio.volume;
  se.play();
}

// =====================
// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
// =====================
let gameState = "start";
let speech = "â€¦";

// =====================
// ç”»åƒ
// =====================
const girlNormal = new Image();
girlNormal.src = "å¥³ã®å­.png";
const girlSurprise = new Image();
girlSurprise.src = "ã³ã£ãã‚Šã—ãŸå¥³ã®å­.png";

const successImg = new Image();
successImg.src = "GinxDOTOWN.png";

let isSurprised = false;
let showSuccessImg = false;

// =====================
// å¯¿å¸ãƒã‚¿
// =====================
const sushiTypes = [
  { name: "ã„ãã‚‰", src: "ã„ãã‚‰ã®ãŠå¯¿å¸.png", speed: 7.5, brake: 0.35 },
  { name: "ã†ã«",   src: "ã†ã«ã®ãŠå¯¿å¸.png",   speed: 8.0, brake: 0.38 },
  { name: "ãˆã³",   src: "ãˆã³ã®ãŠå¯¿å¸.png",   speed: 7.2, brake: 0.33 },
  { name: "ãŸã¾ã”", src: "ãŸã¾ã”ã®ãŠå¯¿å¸.png", speed: 6.8, brake: 0.30 },
  { name: "ã¾ãã‚", src: "ã¾ãã‚ã®ãŠå¯¿å¸.png", speed: 7.8, brake: 0.36 }
];

sushiTypes.forEach(s => {
  const img = new Image();
  img.src = s.src;
  s.img = img;
});

function randomSushi() {
  return sushiTypes[Math.floor(Math.random() * sushiTypes.length)];
}

let currentSushi = randomSushi();

// =====================
// å¯¿å¸çŠ¶æ…‹
// =====================
let sushi = {
  x: 60,
  y: 145,
  speed: 0,
  moving: false
};

const customerX = 420;
const successRange = 22;
let message = "";

// =====================
// æç”»
// =====================
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ãƒ•ã‚©ãƒ³ãƒˆæŒ‡å®š
  ctx.font = "15px monospace";

  // æˆåŠŸã‚¾ãƒ¼ãƒ³
  ctx.fillStyle = "rgba(100,200,120,0.25)";
  ctx.fillRect(customerX - successRange, 130, successRange * 2, 40);

  // ã‚»ãƒªãƒ•
  ctx.fillStyle = "#2b1d12";
  ctx.fillText(speech, 10, 20);

  // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
  ctx.fillStyle = "#c49a6c";
  ctx.fillRect(0, 170, canvas.width, 20);

  // å¥³ã®å­
  const girlImg = isSurprised ? girlSurprise : girlNormal;
  ctx.drawImage(girlImg, customerX - 32, 60, 64, 64);

  // æˆåŠŸç”»åƒ
  if (showSuccessImg) {
    const scale = 0.2; // è¡¨ç¤ºã‚µã‚¤ã‚ºèª¿æ•´ï¼ˆå¥½ã¿ã§ï¼‰
    const w = successImg.width * scale;
    const h = successImg.height * scale;
    ctx.drawImage(
      successImg,
      customerX - w / 2,
      10,
      w,
      h
    );
  }

  // å¯¿å¸
  ctx.drawImage(currentSushi.img, sushi.x - 16, sushi.y - 16, 32, 32);

  if (gameState === "start") {
    ctx.fillText("ã‚¯ãƒªãƒƒã‚¯â‘ ï¼šå¯¿å¸ãŒé€²ã‚€", 120, 50);
    ctx.fillText("ã‚¯ãƒªãƒƒã‚¯â‘¡ï¼šãƒ–ãƒ¬ãƒ¼ã‚­ï¼", 120, 70);
    ctx.fillText("â–¶ ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ã—ï¼", 130, 100);
  }

  if (gameState === "result") {
    ctx.font = "15px monospace";
    ctx.fillStyle = "#2b1d12";
    ctx.fillText(message, 120, 95);
    ctx.fillText("â–¶ ã‚¯ãƒªãƒƒã‚¯ã§ã€ã‚‚ã†ä¸€å›ã§ã™ã—ï¼", 130, 120);
  }
}

// =====================
// æ›´æ–°
// =====================
function update() {
  if (gameState !== "playing") return;

  if (sushi.moving) {
    sushi.x += sushi.speed;
    sushi.speed *= 0.985;

    if (sushi.speed < 0.15) {
      sushi.moving = false;
      judge();
    }
  }
}

// =====================
// åˆ¤å®š
// =====================
function judge() {
  const dist = Math.abs(sushi.x - customerX);
  gameState = "result";

  if (dist < successRange) {
    isSurprised = true;
    showSuccessImg = true;
    message = `ğŸ˜³ ${currentSushi.name}ã§ã™ã—ï¼ï¼Ÿ`;
    speech = "ãƒŠã‚¤ã‚¹ã§ã™ã—ï¼";
    playSE(seWin);
  } else {
    message = "ğŸ˜‚ å¤±æ•—ã§ã™ã—ï¼";
    speech = "è¡Œãã™ãã§ã™ã—ã€œï¼";
    playSE(seFail);
  }
}

// =====================
// æ“ä½œ
// =====================
function action() {
  if (gameState === "start") {
    if (bgmOn && bgm.paused) bgm.play();
    gameState = "playing";
    speech = "ã„ãã¾ã™ã—â€¦";
    return;
  }

  if (gameState === "result") {
    reset();
    return;
  }

  if (!sushi.moving) {
    sushi.speed = currentSushi.speed;
    sushi.moving = true;
    speech = "ã‚·ãƒ¥ãƒ¼ãƒƒã§ã™ã—ï¼ï¼";
    playSE(seSlide);
  } else {
    sushi.speed *= currentSushi.brake;
    speech = "ã¨ã¾ã‚Œã§ã™ã—â€¦ï¼";
  }
}

canvas.addEventListener("click", action);

// =====================
// BGMãƒœã‚¿ãƒ³
// =====================
bgmBtn.onclick = () => {
  bgmOn = !bgmOn;
  bgmBtn.textContent = bgmOn ? "BGM OFF" : "BGM ON";
  bgmOn ? bgm.play() : bgm.pause();
};

// =====================
// ãƒªã‚»ãƒƒãƒˆ
// =====================
function reset() {
  sushi.x = 60;
  sushi.speed = 0;
  sushi.moving = false;
  isSurprised = false;
  showSuccessImg = false;
  speech = "â€¦";
  currentSushi = randomSushi();
  gameState = "start";
}

// =====================
// ãƒ«ãƒ¼ãƒ—
// =====================
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>

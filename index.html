<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>„ÅÇ„Å°„Çâ„ÅÆ„ÅäÂÆ¢Êßò„Åã„Çâ„Åß„Åô„ÅóÔºÅ</title>

<style>
  body {
    margin: 0;
    background: #f3e9d2;
    font-family: "PixelMplus12", sans-serif;
    text-align: center;
  }

  h1 {
    margin: 10px 0;
  }

  #game {
    position: relative;
    width: 800px;
    height: 300px;
    margin: 0 auto;
    background: #d9c29c;
    border: 4px solid #333;
    overflow: hidden;
  }

  #counter {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 60px;
    background: #8b4513;
  }

  #plate {
    position: absolute;
    bottom: 60px;
    left: 560px;
    width: 120px;
    height: 16px;
    background: silver;
    border-radius: 8px;
  }

  #girl {
    position: absolute;
    right: 80px;
    bottom: 76px;
    width: 120px;
  }

  #sushi {
    position: absolute;
    bottom: 80px;
    left: 0;
    width: 64px;
  }

  #message {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 20px;
    background: rgba(255,255,255,0.8);
    padding: 6px 10px;
    border-radius: 6px;
  }

  #result {
    margin-top: 10px;
    font-size: 24px;
  }

  #retry {
    margin-top: 10px;
    font-size: 20px;
    cursor: pointer;
  }

  #logo {
    position: absolute;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 300px;
    display: none;
    pointer-events: none;
  }

  #bgmBtn {
    margin: 10px;
  }
</style>
</head>

<body>

<h1>üç£ „ÅÇ„Å°„Çâ„ÅÆ„ÅäÂÆ¢Êßò„Åã„Çâ„Åß„Åô„ÅóÔºÅ</h1>
<button id="bgmBtn">BGM OFF</button>

<div id="game">
  <div id="message">„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç∑„É•„Éº„Åß„Åô„ÅóÔºÅ</div>

  <img id="sushi" />
  <div id="plate"></div>
  <img id="girl" src="girl.png" />
  <img id="logo" src="GinxDOTOWN.png" />

  <div id="counter"></div>
</div>

<div id="result"></div>
<div id="retry"></div>

<script>
/* ========= „Çµ„Ç¶„É≥„Éâ ========= */
const bgm = new Audio("bgm.mp3");
bgm.loop = true;
bgm.volume = 0.4;

function playSE(src) {
  const se = new Audio(src);
  se.currentTime = 0;
  se.play();
}

/* ========= DOM ========= */
const sushi = document.getElementById("sushi");
const girl = document.getElementById("girl");
const plate = document.getElementById("plate");
const message = document.getElementById("message");
const result = document.getElementById("result");
const retry = document.getElementById("retry");
const logo = document.getElementById("logo");
const bgmBtn = document.getElementById("bgmBtn");

/* ========= ÂØøÂè∏ ========= */
const sushiImages = [
  "sushi_ikura.png",
  "sushi_uni.png",
  "sushi_ebi.png",
  "sushi_tamago.png",
  "sushi_maguro.png"
];

/* ========= Áä∂ÊÖã ========= */
let x = 0;
let speed = 0;
let isPlaying = false;
let isFinished = false;
let rafId = null;

/* ========= ÂàùÊúüÂåñ ========= */
function resetGame() {
  cancelAnimationFrame(rafId);

  x = 0;
  speed = Math.random() * 2 + 3;
  isPlaying = false;
  isFinished = false;

  sushi.src = sushiImages[Math.floor(Math.random() * sushiImages.length)];
  sushi.style.left = "0px";

  girl.src = "girl.png";
  logo.style.display = "none";

  message.textContent = "„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç∑„É•„Éº„Åß„Åô„ÅóÔºÅ";
  result.textContent = "";
  retry.textContent = "";
}

/* ========= „É´„Éº„Éó ========= */
function loop() {
  if (!isPlaying) return;

  x += speed;
  sushi.style.left = x + "px";

  if (x > 800) {
    finish(false);
    return;
  }

  rafId = requestAnimationFrame(loop);
}

/* ========= ÁµÇ‰∫Ü ========= */
function finish(success) {
  isPlaying = false;
  isFinished = true;

  if (success) {
    playSE("se_win.mp3");
    girl.src = "girl_surprise.png";
    logo.style.display = "block";
    result.textContent = "ÊàêÂäü„Åß„Åô„ÅóÔºÅÔºÅüéâ";
  } else {
    playSE("se_fail.mp3");
    result.textContent = "Â§±Êïó„Åß„Åô„Åó‚Ä¶üí¶";
  }

  retry.textContent = "„ÇØ„É™„ÉÉ„ÇØ„Åß„ÄÅ„ÇÇ„ÅÜ‰∏ÄÂõû„Åß„Åô„ÅóÔºÅ";
}

/* ========= Êìç‰Ωú ========= */
document.addEventListener("click", () => {
  // ÂàùÂõûÊìç‰Ωú„ÅßBGMËß£Á¶Å
  if (bgm.paused) bgm.play();

  if (!isPlaying && !isFinished) {
    playSE("se_shu.mp3");
    isPlaying = true;
    message.textContent = "„Ç∑„É•„Éº„Éº„Éº„Åß„Åô„ÅóÔºÅ";
    loop();
    return;
  }

  if (isPlaying) {
    const sushiRect = sushi.getBoundingClientRect();
    const plateRect = plate.getBoundingClientRect();

    const success =
      sushiRect.left > plateRect.left &&
      sushiRect.right < plateRect.right;

    finish(success);
    return;
  }

  if (isFinished) {
    resetGame();
  }
});

/* ========= BGM ========= */
bgm.play();
bgmBtn.addEventListener("click", () => {
  if (bgm.paused) {
    bgm.play();
    bgmBtn.textContent = "BGM OFF";
  } else {
    bgm.pause();
    bgmBtn.textContent = "BGM ON";
  }
});

/* ========= START ========= */
resetGame();
</script>

</body>
</html>

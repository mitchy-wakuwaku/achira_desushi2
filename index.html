<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ã¡ã‚‰ã®ãŠå®¢æ§˜ã‹ã‚‰ã§ã™ã—ï¼</title>
<style>
  body {
    background: #e0d6c3;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    background: #f4efe6;
    border: 4px solid #3b2a1a;
    margin-top: 10px;
  }
  #bgmBtn {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2 style="color:#3b2a1a">ğŸ£ ã‚ã¡ã‚‰ã®ãŠå®¢æ§˜ã‹ã‚‰ã§ã™ã—ï¼ ğŸ£</h2>
<button id="bgmBtn">BGM OFF</button>

<canvas id="game" width="640" height="220"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const bgmBtn = document.getElementById("bgmBtn");

// =====================
// ğŸ”Š Audioï¼ˆæœ€å¼·å®‰å®šï¼‰
// =====================
function playSE(src, volume = 1) {
  const se = new Audio(src);
  se.volume = volume;
  se.play();
}

// BGMï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆONï¼‰
const bgm = new Audio("bgm.mp3");
bgm.loop = true;
bgm.volume = 0.4;
let bgmOn = true;

// =====================
// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
// =====================
let gameState = "start";
let speech = "â€¦";
let message = "";

// =====================
// ç”»åƒ
// =====================
const girlNormal = new Image();
girlNormal.src = "girl.png";

const girlSurprise = new Image();
girlSurprise.src = "girl_surprise.png";

const successImg = new Image();
successImg.src = "GinxDOTOWN.png";

let isSurprised = false;
let showSuccessImg = false;

// =====================
// å¯¿å¸
// =====================
const sushiTypes = [
  { name: "ã„ãã‚‰", src: "sushi_ikura.png", speed: 7.5, brake: 0.35 },
  { name: "ã†ã«", src: "sushi_uni.png", speed: 8.0, brake: 0.38 },
  { name: "ãˆã³", src: "sushi_ebi.png", speed: 7.2, brake: 0.33 },
  { name: "ãŸã¾ã”", src: "sushi_tamago.png", speed: 6.8, brake: 0.30 },
  { name: "ã¾ãã‚", src: "sushi_maguro.png", speed: 7.8, brake: 0.36 }
];

sushiTypes.forEach(s => {
  s.img = new Image();
  s.img.src = s.src;
});

function randomSushi() {
  return sushiTypes[Math.floor(Math.random() * sushiTypes.length)];
}

let currentSushi = randomSushi();

// =====================
// å¯¿å¸çŠ¶æ…‹
// =====================
let sushi = { x: 60, y: 145, speed: 0, moving: false };
const customerX = 420;
const successRange = 22;

// =====================
// æç”»
// =====================
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.font = "16px monospace";

  // ğŸ¥ˆ éŠ€ã®çš¿ï¼ˆæˆåŠŸã‚¾ãƒ¼ãƒ³ï¼‰
  ctx.save();
  ctx.translate(customerX, 150);
  ctx.scale(1.6, 0.6);
  ctx.beginPath();
  ctx.arc(0, 0, successRange, 0, Math.PI * 2);
  ctx.fillStyle = "#dcdcdc";
  ctx.fill();
  ctx.lineWidth = 2;
  ctx.strokeStyle = "#999";
  ctx.stroke();
  ctx.restore();

  // ã‚»ãƒªãƒ•
  ctx.fillStyle = "#2b1d12";
  ctx.fillText(speech, 10, 22);

  // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
  ctx.fillStyle = "#c49a6c";
  ctx.fillRect(0, 170, canvas.width, 20);

  // å¥³ã®å­
  const girlImg = isSurprised ? girlSurprise : girlNormal;
  if (girlImg.complete) {
    ctx.drawImage(girlImg, customerX - 32, 60, 64, 64);
  }

  // æˆåŠŸãƒ­ã‚´
  if (showSuccessImg && successImg.complete) {
    const scale = 0.2;
    ctx.drawImage(
      successImg,
      customerX - successImg.width * scale / 2,
      5,
      successImg.width * scale,
      successImg.height * scale
    );
  }

  // å¯¿å¸
  if (currentSushi.img.complete) {
    ctx.drawImage(currentSushi.img, sushi.x - 16, sushi.y - 16, 32, 32);
  }

  // UI
  if (gameState === "start") {
    ctx.fillText("ã‚¯ãƒªãƒƒã‚¯â‘ ï¼šå¯¿å¸ãŒé€²ã‚€", 120, 55);
    ctx.fillText("ã‚¯ãƒªãƒƒã‚¯â‘¡ï¼šãƒ–ãƒ¬ãƒ¼ã‚­ï¼", 120, 75);
    ctx.fillText("â–¶ ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ã—ï¼", 130, 105);
  }

  if (gameState === "result") {
    ctx.fillText(message, 120, 95);
    ctx.fillText("â–¶ ã‚¯ãƒªãƒƒã‚¯ã§ã€ã‚‚ã†ä¸€å›ã§ã™ã—ï¼", 120, 120);
  }
}

// =====================
// æ›´æ–°
// =====================
function update() {
  if (gameState === "playing" && sushi.moving) {
    sushi.x += sushi.speed;
    sushi.speed *= 0.985;

    if (sushi.speed < 0.15) {
      sushi.moving = false;
      judge();
    }
  }
}

// =====================
// åˆ¤å®š
// =====================
function judge() {
  gameState = "result";

  const plateRadiusX = successRange * 1.6; // éŠ€ã®çš¿ã®æ¨ªåŠå¾„
  const distX = Math.abs(sushi.x - customerX);

  if (distX < plateRadiusX) {
    isSurprised = true;
    showSuccessImg = true;
    message = `ğŸ˜³ ${currentSushi.name}ã§ã™ã—ï¼ï¼Ÿ`;
    speech = "ãƒŠã‚¤ã‚¹ã§ã™ã—ï¼";
    playSE("se_win.mp3");
  } else {
    message = "ğŸ˜‚ å¤±æ•—ã§ã™ã—ï¼";
    speech = sushi.x < customerX
      ? "æ‰‹å‰ã§ã™ã—ã€œï¼"
      : "è¡Œãã™ãã§ã™ã—ã€œï¼";
    playSE("se_fail.mp3");
  }
}

// =====================
// æ“ä½œ
// =====================
canvas.addEventListener("click", () => {
  if (gameState === "start") {
    gameState = "playing";
    speech = "ã„ãã¾ã™ã—â€¦";
    if (bgmOn && bgm.paused) bgm.play();
    return;
  }

  if (gameState === "result") {
    reset();
    return;
  }

  if (!sushi.moving) {
    sushi.speed = currentSushi.speed;
    sushi.moving = true;
    speech = "ã‚·ãƒ¥ãƒ¼ãƒƒã§ã™ã—ï¼ï¼";
    playSE("se_shu.mp3");
  } else {
    sushi.speed *= currentSushi.brake;
    speech = "ã¨ã¾ã‚Œã§ã™ã—â€¦ï¼";
  }
});

// =====================
// BGMãƒœã‚¿ãƒ³
// =====================
bgmBtn.onclick = () => {
  bgmOn = !bgmOn;
  bgmBtn.textContent = bgmOn ? "BGM OFF" : "BGM ON";
  bgmOn ? bgm.play() : bgm.pause();
};

// =====================
// ãƒªã‚»ãƒƒãƒˆ
// =====================
function reset() {
  sushi.x = 60;
  sushi.speed = 0;
  sushi.moving = false;
  isSurprised = false;
  showSuccessImg = false;
  speech = "â€¦";
  message = "";
  currentSushi = randomSushi();
  gameState = "start";
}

// =====================
// ãƒ«ãƒ¼ãƒ—
// =====================
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
